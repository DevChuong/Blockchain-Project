<!DOCTYPE HTML>
<html>
	<head>
		<title>Authorize blockchain project</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<script src="./node_modules/web3/dist/web3.min.js"></script>
		<link rel="stylesheet" href="./cssfiles/Authorize.css">



	<body class="is-preload">

		<!-- Header -->
			<header id="header">
				<a class="logo" href="index.html">Block chain project</a>

				<div style="background-color: #00ff00; color: black; font-weight: bold;">
					<input type="text" id="Account_Address" disabled="" size="73">
				</div>

				<nav>
					<a href="#menu">Menu</a>
				</nav>

			</header>

			<!-- Nav -->
				<nav id="menu">
					<ul class="links">
						<li><a href="index.html">Home</a></li>
						<li><a href="Authorise.html">Authorize</a></li>
						<li><a href="Unauthorize.html">Unauthorize</a></li>
						<li><a href="Add_Records.html">Add records</a></li>
						<li><a href="Look_Up.html">Look up info</a></li>
						<li><a href="Sign_Verify.html">Sign/Verify</a></li>
						<li><a href="Look_Up_Records.html">Employee records</a></li>
					</ul>
				</nav>

		<!-- Banner -->
			<section id="banner">
				<div class="inner">
					<h1>Block chain in health care</h1>
					<p>This website is used for authorizing/unauthorizing, adding records and looking up information from the system<br />
					it also used for signing and verifying message.</p>
				</div>
				<video autoplay loop muted playsinline src="images/hospital.mp4"></video>
			</section>

		<!-- Highlights -->
			<section class="wrapper">

				<!-- Message -->
					<header class="special">
						<h2>Authorize employees/hospitals</h2>
						<p>Make sure you are using the right authorized account!.</p>
					</header>

				<!-- Choice Section -->

					<div id="choice_section">
						<select name="category" id="category">
							<option value="">- Select the one you want to authorize -</option>
							<option value="hospital_choice">Authorizing Hospital</option>
							<option value="employee_choice">Authorizing Employee</option>
						</select>
					</div>



				<!-- Hospital Form -->
					<div id="hospital_form">
							<div class="row gtr-uniform">
								<div class="col-8 col-12-xsmall">
									Input your hospital address here:
									<br>
									<input type="text" id="hospital_address_field" />
								</div>
								<div class="col-8 col-12-xsmall">
									Input your hospital ID here:
									<br>
									<input type="text" id="hospital_id_field" />
								</div>
								<div class="col-8 col-12-xsmall">
									Input your hospital name here:
									<br>
									<input type="text" id="hospital_name_field" />
								</div>
								<div class="col-4">
									<br>
									<button id="hospital_button" class="btn primary">Authorize Hospital</button>
								</div>
							</div>
					</div>

				<!-- Employee Form -->
					<div id="employee_form">
						<div class="row gtr-uniform">
							<div class="col-12 col-12-xsmall">
								Input the hospital address that wants to authorize here:
								<br>
								<input disabled="" type="text" id="employee_hospital_address_field">
							</div>
							<div class="col-12 col-12-xsmall">
								Input the Trainee Address here:
								<br>
								<input type="text" id="employee_trainee_address_field">
							</div>
							<div class="col-6 col-12-xsmall">
								Input the Trainee ID Here:
								<br>
								<input type="text" id="employee_trainee_id_field">
							</div>
							<div class="col-6 col-12-xsmall">
								Input the Trainee Name here:
								<br>
								<input type="text" id="employee_trainee_name_field">
							</div>
							<div class="col-6 col-12-xsmall">
								Input the Hospital Name that the trainee wants to work for here:
								<br>
								<input type="text" id="employee_trainee_hospital_name_field">
							</div>
							<div class="col-6 col-12-xsmall">
								<br>
								<button class="btn primary" id="employee_button">Authorize Employee</button>
							</div>

						</div>
					</div>
					<br>
					<br>
					<br>

					<button onclick="getBooks()" class="col-6 col-12xsmall">FETCH API</button>
					<div class="col-6 col-12xsmall" id="output"></div>



			</section>




		<!-- Footer -->
			<footer id="footer">
				<div class="inner">
					<div class="content">
						<section>
							<h3>About the project</h3>
							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum..</p>
						</section>
						<section>
							<h4>Functions</h4>
							<ul class="alt">
								<li><a href="index.html">Home</a></li>
								<li><a href="unauth.html">Unauthorize</a></li>
								<li><a href="add_rec.html">Add records</a></li>
								<li><a href="lookuppage.html">Look up info</a></li>
								<li><a href="signverifymessage.html">Sign/Verify</a></li>
								<li><a href="lookuprecords.html">Employee records</a></li>
							</ul>
						</section>
						<section>
							<h4>Team social media</h4>
							<ul class="plain">
								<li><a href="#"><i class="icon fa-twitter">&nbsp;</i>Twitter</a></li>
								<li><a href="#"><i class="icon fa-facebook">&nbsp;</i>Facebook</a></li>
								<li><a href="#"><i class="icon fa-instagram">&nbsp;</i>Instagram</a></li>
								<li><a href="#"><i class="icon fa-github">&nbsp;</i>Github</a></li>
							</ul>
						</section>
					</div>
					<div class="copyright">
						&copy; This is the blockchain project website.
					</div>
				</div>
			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script>
				$(function(){
					$("#Account_Address").val( "Index: " + index +" Account address: " + account);
					$("#employee_hospital_address_field").val(account);

				});
			</script>

		<!-- Show - Hide Choice Section -->
			<script>
				$(function() {
					$("select[name='category']").change(function(){
						if($(this).val() == "hospital_choice") {
							$("#hospital_form").show();
						}else {
							$("#hospital_form").hide();
						}
					});
				$("select[name='category']").change(function(){
						if($(this).val() == "employee_choice") {
							$("#employee_form").show();

						}else {
							$("#employee_form").hide();
						}
					});

				});

			</script>

		<!-- Authorize Hospital -->
			<script>
				$(function() {
					$("#hospital_button").click(function(){
							try{
							var HospitalAddress = $("#hospital_address_field").val();
							var HospitalID = $("#hospital_id_field").val();
							var HospitalName = $("#hospital_name_field").val();
							//  kiểm tra cái địa chỉ của bệnh viện xem đã bị lưu trên BC chưa thế nào?

							contract.Authorise_Hospital(HospitalAddress,HospitalID,HospitalName, {from: account, gas:3000000});

							setInterval(function(){
								cache_clear();
							})

							alert("Your new hospital is added successfully !");
						}catch(eer) {
							if(account != web3.eth.accounts[0]) {
								alert("Error: This is not the NA account,please change your account!");
							} else {
								alert("Error: Your information is not correct, please check again !");
							}
						}
					});
				});

				function cache_clear() {
					window.location.reload(true);
				}

			</script>

		<!-- Authorize Employee -->
			<script>
				$(function() {
					$("#employee_button").click(function() {
						try{
						var EmployeeHospitalAddress = $("#employee_hospital_address_field").val();
						var TraineeAddress = $("#employee_trainee_address_field").val();
						var TraineID = $("#employee_trainee_id_field").val();
						var TraineeName = $("#employee_trainee_name_field").val();
						var TraineeHospitalName = $("#employee_trainee_hospital_name_field").val();

						contract.Add_Employees(EmployeeHospitalAddress,TraineeAddress,TraineID,TraineeName,TraineeHospitalName, {from: account, gas: 3000000});

						setInterval(function(){
							cache_clear();
						})

						alert("Your new employee is added successfully!");

						} catch(eer) {
							if(EmployeeHospitalAddress == "0x0000000000000000000000000000000000000000") {
								alert("Error: please check the infomation again !");
							}else {
								alert("Error: please check the infomation again !");
							}
						}

					});
				});

			</script>

		<!-- Gọi APi -->
			<script>
				function getBooks() {
				    const proxyurl = "https://cors-anywhere.herokuapp.com/";
		    	    const url = "http://fad141e0.ngrok.io/resources/books?id=1";
					fetch(proxyurl + url)
					.then((response) => response.json())
					.then((data) =>{
						let output = "<h2>Books</h2>";
						data.forEach(function(book){
							output = output + `
							<ul>
								<li>ID: ${book.id}</li>
								<li>Name: ${book.name}</li>
							</ul>
							`;
						});
						document.getElementById("output").innerHTML = output;
					});
				}
			</script>







		<!-- web3 -->
			<script>
				if(typeof web3 !== 'undefined'){
					web3 = new Web3(web3.currentProvider);
				} else {
					web3 = new Web3(new Web3.providers.HttpProvider("HTTP://127.0.0.1:8545"));
				}

				var index = 2;
				web3.eth.defaultAccount =  web3.eth.accounts[index];

				var account = web3.eth.defaultAccount

				var contract = web3.eth.contract([
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_TraineeAddress",
				"type": "address"
			},
			{
				"name": "_TraineeID",
				"type": "uint256"
			},
			{
				"name": "_TraineeName",
				"type": "string"
			},
			{
				"name": "_TrHospitalName",
				"type": "string"
			}
		],
		"name": "Add_Employees",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_TraineeAddress",
				"type": "address"
			},
			{
				"name": "_TraineeID",
				"type": "uint256"
			},
			{
				"name": "_TraineeName",
				"type": "string"
			},
			{
				"name": "_TrHospitaName",
				"type": "string"
			},
			{
				"name": "_ID_Record",
				"type": "uint256"
			},
			{
				"name": "_Record_Hashing",
				"type": "string"
			},
			{
				"name": "_TraineeCertificate",
				"type": "string"
			},
			{
				"name": "_Signature",
				"type": "string"
			}
		],
		"name": "Add_Records",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_HospitalID",
				"type": "uint256"
			},
			{
				"name": "_HospitalName",
				"type": "string"
			}
		],
		"name": "Authorise_Hospital",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_TraineeAddress",
				"type": "address"
			},
			{
				"name": "_TraineeID",
				"type": "uint256"
			}
		],
		"name": "deleteEmployee",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_HospitalID",
				"type": "uint256"
			}
		],
		"name": "deleteHospital",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_TraineeAddress",
				"type": "address"
			}
		],
		"name": "getListOfTraineesRecords",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_HospitalID",
				"type": "uint256"
			}
		],
		"name": "delete_Hospital",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_TraineeAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_TraineeID",
				"type": "uint256"
			},
			{
				"indexed": false,
				"name": "_TraineeName",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "_TrHospitaName",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "_ID_Record",
				"type": "uint256"
			},
			{
				"indexed": false,
				"name": "_Record_Hashing",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "_TraineeCertificate",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "_Signature",
				"type": "string"
			}
		],
		"name": "add_Records",
		"type": "event"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "_NationalAuthority",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getListOfHospitals",
		"outputs": [
			{
				"components": [
					{
						"name": "_HospitalAddress",
						"type": "address"
					},
					{
						"name": "_HospitalID",
						"type": "uint256"
					},
					{
						"name": "_HospitalName",
						"type": "string"
					}
				],
				"name": "",
				"type": "tuple[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getListOfTrainees",
		"outputs": [
			{
				"components": [
					{
						"name": "_TraineeAddress",
						"type": "address"
					},
					{
						"name": "_TraineeID",
						"type": "uint256"
					},
					{
						"name": "_TraineeName",
						"type": "string"
					},
					{
						"name": "_TrHospitaName",
						"type": "string"
					},
					{
						"name": "_ID_Record",
						"type": "uint256"
					},
					{
						"name": "_Record_Hashing",
						"type": "string"
					},
					{
						"name": "_TraineeCertificate",
						"type": "string"
					},
					{
						"name": "_Signature",
						"type": "string"
					}
				],
				"name": "",
				"type": "tuple[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "OfficialEmployees",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "Records",
		"outputs": [
			{
				"components": [
					{
						"name": "_TraineeAddress",
						"type": "address"
					},
					{
						"name": "_TraineeID",
						"type": "uint256"
					},
					{
						"name": "_TraineeName",
						"type": "string"
					},
					{
						"name": "_TrHospitaName",
						"type": "string"
					},
					{
						"name": "_ID_Record",
						"type": "uint256"
					},
					{
						"name": "_Record_Hashing",
						"type": "string"
					},
					{
						"name": "_TraineeCertificate",
						"type": "string"
					},
					{
						"name": "_Signature",
						"type": "string"
					}
				],
				"name": "",
				"type": "tuple[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "hash",
				"type": "bytes32"
			},
			{
				"name": "sig",
				"type": "bytes"
			}
		],
		"name": "recoverSigner",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			}
		],
		"name": "See_Authorised_Hospital",
		"outputs": [
			{
				"name": "",
				"type": "address"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_TraineeAddress",
				"type": "address"
			}
		],
		"name": "See_Employee_Info",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_TraineeAddress",
				"type": "address"
			}
		],
		"name": "See_Employee_Latest_Records",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
]).at('0x039b94acf82b88b67fc3aa9e62c6445be9a05b4a');

			</script>









	</body>
</html>
