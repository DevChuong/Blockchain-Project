<!DOCTYPE HTML>
<html>
	<head>
		<title>Authorizing</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<script src="./node_modules/web3/dist/web3.min.js"></script>
		<link rel="stylesheet" href="./cssfiles/Authorize.css">



	<body class="is-preload">

		<!-- Header -->
			<header id="header">
				<a class="logo" href="index.html">Blockchain ProJect</a>

				<div style="background-color: #00ff00; color: black; font-weight: bold;">
					<input type="text" id="Account_Address" disabled="" size="73" style="width: 670px;font-weight: 600;">
				</div>

				<nav>
					<a href="#menu">Menu</a>
				</nav>

			</header>

			<!-- Nav -->
				<nav id="menu">
					<ul class="links">
						<li><a href="index.html">Home</a></li>
						<li><a href="Authorise.html">Authorize</a></li>
						<li><a href="Unauthorize.html">Unauthorize</a></li>
						<li><a href="Add_Records.html">Add records</a></li>
						<li><a href="Look_Up.html">Look up info</a></li>
						<li><a href="Sign_Verify.html">Sign/Verify</a></li>
						<li><a href="Look_Up_Records.html">Employee records</a></li>
					</ul>
				</nav>

		<!-- Banner -->
			<section id="banner">
				<div class="inner">
					<h1>Block chain in health care</h1>
					<p >This website's used for authorizing/unauthorizing, adding records and searching information from the system
					It's also used for signing and verifying certificate.</p>
				</div>
				<video autoplay loop muted playsinline src="images/hospital.mp4"></video>
			</section>

		<!-- Highlights -->
			<section class="wrapper">

				<!-- Message -->
					<header class="special">
						<h2>Authorize employees/hospitals</h2>
						<p>Make sure you are using the right authorized account!.</p>
					</header>

				<!-- Choice Section -->

					<div id="choice_section">
						<select name="category" id="category">
							<option value="">- Select the one you want to authorize -</option>
							<option value="hospital_choice" style="font-weight:bold;">Authorizing Hospital</option>
							<option value="employee_choice" style="font-weight:bold;">Authorizing Employee</option>
						</select>
					</div>



				<!-- Hospital Form -->
					<div id="hospital_form">
							<div class="row gtr-uniform">
								<div class="col-8 col-12-xsmall" style="font-weight: 600;">
									Input your hospital address here:
									<br>
									<input type="text" id="hospital_address_field" style="font-weight: 600;" />
								</div>
								<div class="col-8 col-12-xsmall" style="font-weight: 600;">
									Input your hospital ID here:
									<br>
									<input type="text" id="hospital_id_field" style="font-weight: 600;"/>
								</div>
								<div class="col-8 col-12-xsmall" style="font-weight: 600;">
									Input your hospital name here:
									<br>
									<input type="text" id="hospital_name_field" style="font-weight: 600;"/>
								</div>
								<div class="col-4">
									<br>
									<button id="hospital_button" class="btn primary" style="width:300px; font-size:20px;">Authorize Hospital</button>
								</div>
							</div>
					</div>

				<!-- Employee Form -->
					<div id="employee_form">
						<div class="row gtr-uniform">
							<div class="col-12 col-12-xsmall" style="font-weight: 600;">
								Input the hospital address that wants to authorize here:
								<br>
								<input disabled="" type="text" id="employee_hospital_address_field" style="font-weight: 600;">
							</div>
							<div class="col-12 col-12-xsmall" style="font-weight: 600;">
								Input the Trainee Address here:
								<br>
								<input type="text" id="employee_trainee_address_field" style="font-weight: 600;">
							</div>
							<div class="col-6 col-12-xsmall" style="font-weight: 600;">
								Input the Trainee ID Here:
								<br>
								<input type="text" id="employee_trainee_id_field" style="font-weight: 600;">
							</div>
							<div class="col-6 col-12-xsmall" style="font-weight: 600;">
								Input the Trainee Name here:
								<br>
								<input type="text" id="employee_trainee_name_field" style="font-weight: 600;">
							</div>
							<div class="col-6 col-12-xsmall" style="font-weight: 600;">
								Input the Trainee Hospital Name:
								<br>
								<input type="text" id="employee_trainee_hospital_name_field" style="font-weight: 600;">
							</div>
							<div class="col-6 col-12-xsmall">
								<br>
								<button class="btn primary" id="employee_button" style="width:300px; font-size:20px;">Authorize Employee</button>
							</div>

						</div>
					</div>
					<br>
					<br>
					<br>




			</section>




		<!-- Footer -->
			<footer id="footer">
				<div class="inner">
					<div class="content">
						<section>
							<h3>About the project</h3>
							<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum..</p>
						</section>
						<section>
							<h4>Functions</h4>
							<ul class="alt">
								<li><a href="index.html">Home</a></li>
								<li><a href="unauth.html">Unauthorize</a></li>
								<li><a href="add_rec.html">Add records</a></li>
								<li><a href="lookuppage.html">Look up info</a></li>
								<li><a href="signverifymessage.html">Sign/Verify</a></li>
								<li><a href="lookuprecords.html">Employee records</a></li>
							</ul>
						</section>
						<section>
							<h4>Team social media</h4>
							<ul class="plain">
								<li><a href="#"><i class="icon fa-twitter">&nbsp;</i>Twitter</a></li>
								<li><a href="#"><i class="icon fa-facebook">&nbsp;</i>Facebook</a></li>
								<li><a href="#"><i class="icon fa-instagram">&nbsp;</i>Instagram</a></li>
								<li><a href="#"><i class="icon fa-github">&nbsp;</i>Github</a></li>
							</ul>
						</section>
					</div>
					<div class="copyright">
						&copy; This is the blockchain project website.
					</div>
				</div>
			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script>
				$(function(){
					$("#Account_Address").val( "Index: " + index +" Account address: " + account);
					$("#employee_hospital_address_field").val(account);

				});
			</script>

		<!-- Show - Hide Choice Section -->
			<script>
				$(function() {
					$("select[name='category']").change(function(){
						if($(this).val() == "hospital_choice") {
							$("#hospital_form").show();
						}else {
							$("#hospital_form").hide();
						}
					});
				$("select[name='category']").change(function(){
						if($(this).val() == "employee_choice") {
							$("#employee_form").show();

						}else {
							$("#employee_form").hide();
						}
					});

				});

			</script>

		<!-- Authorize Hospital -->
			<script>
				$(function() {
					$("#hospital_button").click(function(){
							try{
							var HospitalAddress = $("#hospital_address_field").val();
							var HospitalID = $("#hospital_id_field").val();
							var HospitalName = $("#hospital_name_field").val();
							//  kiểm tra cái địa chỉ của bệnh viện xem đã bị lưu trên BC chưa thế nào?
							var addressCheck = web3.isAddress(HospitalAddress);
							if(addressCheck == true){
								contract.Authorise_Hospital(HospitalAddress,HospitalID,HospitalName, {from: account, gas:3000000});
							}
							else{
								alert("Error: Invalid Address !");
							}


							setInterval(function(){
								cache_clear();
							})

							alert("Your new hospital is added successfully !");
						}catch(eer) {
							if(account != web3.eth.accounts[0]) {
								alert("Error: This is not the NA account, please change your account!");
							} else {
								alert("Error: Your information is not correct, please check again !");
							}
						}
					});
				});

				function cache_clear() {
					window.location.reload(true);
				}

			</script>

		<!-- Authorize Employee -->
			<script>
				$(function() {
					$("#employee_button").click(function() {
						try{
							var Hospital_Address = account;
							var Employee_Address = $("#employee_trainee_address_field").val();
							var ID_Employee = $('#employee_trainee_id_field').val();
							var Employee_Name = $('#employee_trainee_name_field').val();
							var Employee_Hospital = $('#employee_trainee_hospital_name_field').val();
							//alert(Employee_Address);
							var addressCheck = web3.isAddress(Employee_Address);
							//console.log(addressCheck);
							//console.log(typeof(addressCheck));
							var isTrue = true;
							console.log(typeof(isTrue));
							if(addressCheck == true){
								var result = "";
								const proxyurl = "https://cors-anywhere.herokuapp.com/";
								const url = "http://5ed5990f.ngrok.io/user/check?ID_Employee=" + ID_Employee + "&Employee_Name=" + Employee_Name;
							 // console.log(url);// site that doesn’t send Access-Control-*
								fetch(proxyurl + url) // https://cors-anywhere.herokuapp.com/https://example.com
								.then(response => response.json())
								.then(contents => {
									result = contents;
									if (result == 1){

										contract.Add_Employees(Hospital_Address, Employee_Address, ID_Employee, Employee_Name, Employee_Hospital, {from : account, gas : 3000000});
										alert("The Trainee has been authorized successfully on the BlockChain !");
										setInterval(function() {
											cache_clear()
										});

									}else {
										alert("The Trainee Not Found in the system !");
									}
								})
								.catch(() => console.log("Can’t access " + url + " response. Blocked by browser?"));
							}else{
								alert("Error: Invalid Address");
							}


					}catch{
						if(account != HospitalAddress)
						{
							alert("The Hospital Address and your account address isn't match !");
							alert("Please check the information again !");
						}
						else {
							alert("Error: Please check the information again !");
						}
					}

					});
				});

			</script>


		<!-- web3 -->
			<script>
				if(typeof web3 !== 'undefined'){
					web3 = new Web3(web3.currentProvider);
				} else {
					web3 = new Web3(new Web3.providers.HttpProvider("HTTP://127.0.0.1:8545"));
				}

				var index = 1;
				web3.eth.defaultAccount =  web3.eth.accounts[index];

				var account = web3.eth.defaultAccount

				var contract = web3.eth.contract([
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_TraineeAddress",
				"type": "address"
			},
			{
				"name": "_TraineeID",
				"type": "uint256"
			},
			{
				"name": "_TraineeName",
				"type": "string"
			},
			{
				"name": "_TrHospitalName",
				"type": "string"
			}
		],
		"name": "Add_Employees",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_TraineeAddress",
				"type": "address"
			},
			{
				"name": "_TraineeID",
				"type": "uint256"
			},
			{
				"name": "_TraineeName",
				"type": "string"
			},
			{
				"name": "_TrHospitaName",
				"type": "string"
			},
			{
				"name": "_ID_Record",
				"type": "uint256"
			},
			{
				"name": "_Record_Hashing",
				"type": "string"
			},
			{
				"name": "_TraineeCertificate",
				"type": "string"
			},
			{
				"name": "_Signature",
				"type": "string"
			}
		],
		"name": "Add_Records",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_HospitalID",
				"type": "uint256"
			},
			{
				"name": "_HospitalName",
				"type": "string"
			}
		],
		"name": "Authorise_Hospital",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_TraineeAddress",
				"type": "address"
			},
			{
				"name": "_TraineeID",
				"type": "uint256"
			}
		],
		"name": "deleteEmployee",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"name": "_HospitalID",
				"type": "uint256"
			}
		],
		"name": "deleteHospital",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_TraineeAddress",
				"type": "address"
			}
		],
		"name": "getListOfTraineesRecords",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_HospitalID",
				"type": "uint256"
			}
		],
		"name": "delete_Hospital",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "_HospitalAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_TraineeAddress",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_TraineeID",
				"type": "uint256"
			},
			{
				"indexed": false,
				"name": "_TraineeName",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "_TrHospitaName",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "_ID_Record",
				"type": "uint256"
			},
			{
				"indexed": false,
				"name": "_Record_Hashing",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "_TraineeCertificate",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "_Signature",
				"type": "string"
			}
		],
		"name": "add_Records",
		"type": "event"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "_NationalAuthority",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "getFullRecords",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getListOfHospitals",
		"outputs": [
			{
				"components": [
					{
						"name": "_HospitalAddress",
						"type": "address"
					},
					{
						"name": "_HospitalID",
						"type": "uint256"
					},
					{
						"name": "_HospitalName",
						"type": "string"
					}
				],
				"name": "",
				"type": "tuple[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getListOfTrainees",
		"outputs": [
			{
				"components": [
					{
						"name": "_TraineeAddress",
						"type": "address"
					},
					{
						"name": "_TraineeID",
						"type": "uint256"
					},
					{
						"name": "_TraineeName",
						"type": "string"
					},
					{
						"name": "_TrHospitaName",
						"type": "string"
					},
					{
						"name": "_ID_Record",
						"type": "uint256"
					},
					{
						"name": "_Record_Hashing",
						"type": "string"
					},
					{
						"name": "_TraineeCertificate",
						"type": "string"
					},
					{
						"name": "_Signature",
						"type": "string"
					}
				],
				"name": "",
				"type": "tuple[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getListOfTraineesRecordsLength",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "OfficialEmployees",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "Records",
		"outputs": [
			{
				"components": [
					{
						"name": "_TraineeAddress",
						"type": "address"
					},
					{
						"name": "_TraineeID",
						"type": "uint256"
					},
					{
						"name": "_TraineeName",
						"type": "string"
					},
					{
						"name": "_TrHospitaName",
						"type": "string"
					},
					{
						"name": "_ID_Record",
						"type": "uint256"
					},
					{
						"name": "_Record_Hashing",
						"type": "string"
					},
					{
						"name": "_TraineeCertificate",
						"type": "string"
					},
					{
						"name": "_Signature",
						"type": "string"
					}
				],
				"name": "",
				"type": "tuple[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "hash",
				"type": "bytes32"
			},
			{
				"name": "sig",
				"type": "bytes"
			}
		],
		"name": "recoverSigner",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_HospitalAddress",
				"type": "address"
			}
		],
		"name": "See_Authorised_Hospital",
		"outputs": [
			{
				"name": "",
				"type": "address"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_TraineeAddress",
				"type": "address"
			}
		],
		"name": "See_Employee_Info",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_TraineeAddress",
				"type": "address"
			}
		],
		"name": "See_Employee_Latest_Records",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
]).at('0x023403ab74f409120836426281a260f198e7d6fa');

			</script>









	</body>
</html>
